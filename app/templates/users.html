{% extends "layout.html" %}

{% block style %}
<link href="{{url_for('static',filename='css/users.css')}}" rel="stylesheet" type="text/css">
    {% endblock %}
{% block body %}
    <div class="w-25 mx-auto main-div">
        <div class="container card py-3">
            {% include "flash.html" %}
            <div class="px-3 py-3 h-100 con">
                <div class="row align-items-center">
                    <div class="col d-flex">
                        <div class="d-flex">
                            <img class="rounded-circle border pfp border-dark" height="50" src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fcdn3.iconfinder.com%2Fdata%2Ficons%2Fpopular-services-brands-vol-2%2F512%2Fstackoverflow-512.png&f=1&nofb=1" width="50">
                            
                        </div>
                        <div class="ps-2">
                            <span class="fw-bold fs-5">
                                {{current_user.username}}
                            </span>
                            <br>
                                <span>
                                    Active
                                </span>
                           
                        </div>
                    </div>
                    <div class="col">
                        <form action="/logout" method="post">
                            <button class="btn btn-dark btn-sm float-end" type="submit">
                                logout
                            </button>
                        </form>
                    </div>
                </div>
                <hr>
                    <div class="input-group mb-3 align-items-center justify-content-around">
                        <p class="text-muted fw-bold mb-0 p-desc">
                            Choose User To Chat
                        </p>
                        <input class="form-control d-none rounded" id="my_inp" placeholder="Enter Name to Search" type="text">
                            <i aria-hidden="true" class="fa fa-search search">
                            </i>
                            <button class="btn btn-dark d-none close">
                                <i class="fas fa-window-close fa-1x">
                                </i>
                            </button>
                        
                    </div>
                    <div class="user">
                        {% if users|length == 0%}
                        <div class="px-2 d-flex align-items-center justify-content-center h-100 empty">
                            <p class="text-center text-muted">
                                It's empty for now. No user to chat.
                            </p>
                        </div>
                        {% endif %}
                        {% for user in users %}
                        <a href="/chat/{{user.username}}" >
                        <div class="align-items-center d-flex hover py-2">
                            <img class="rounded-circle border border-dark" height="40" src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fcdn3.iconfinder.com%2Fdata%2Ficons%2Fpopular-services-brands-vol-2%2F512%2Fstackoverflow-512.png&f=1&nofb=1" width="40">
                            
                            <div class="ps-2" style="white-space: nowrap;">
                                <span class="fw-bold text-dark fs-5">
                                    {{user.username}}
                                </span>
                                <br>
                                    <span class="span fs-6 fw-lighter text-dark">
                                        {% for i in msg %}
                                        {% if i.get_user == user.username %}
                                        {% if i.msg_type == "right" %}
                                        You: {{i.msg}}
                                        {% else %}
                                        {{i.msg}}
                                        
                                        {% endif %}

                                        {% endif %}
                                        {% endfor %}

                                        
                                    
                                </span>

                            </div>
                            <div class="status w-100 position-relative " >
                                    <i class="fa fa-circle float-end" aria-hidden="true" style="font-size:10px;"></i>
                                </div>
                        </div>
                    </a>
                        <hr class="m-0">
                            {% endfor %}
                       
                    </div>
                
            </div>
        </div>
    </div>
    <script type="text/javascript">
        $(document).ready(function(){
        socket = io.connect(document.href );
socket.on("msg",data=>{
    data.rec_user == "{{current_user.username}}" ? $($($(`a[href="/chat/${data.user}"]`).children().children()[1]).children()[2]).html(data.msg) : $($($(`a[href="/chat/${data.rec_user}"]`).children().children()[1]).children()[2]).html(`You: ${data.msg}`)    



    

})

socket.on("regis", data => {
    console.log(data)
    $(".empty").remove()
    $(".user").append(`<a href="/chat/${data}">
    <div class="align-items-center d-flex hover py-2">
        <img class="rounded-circle border border-dark" height="40" src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fcdn3.iconfinder.com%2Fdata%2Ficons%2Fpopular-services-brands-vol-2%2F512%2Fstackoverflow-512.png&f=1&nofb=1" width="40">
            <div class="ps-2" style="white-space: nowrap;">
                <span class="fw-bold text-dark fs-5">
                    ${data}
                </span>
                <br>
                    <span class="span fs-6 fw-lighter text-dark">

                    </span>
                </br>
            </div>
        </img>
    </div>
</a>
<hr class="m-0"/>
`)
  })

        
        $(".search").click(function(){
       $(this).hide() 

       $("#my_inp").removeClass("d-none")
       $("#my_inp").focus()
       $(".p-desc").addClass("d-none")
       $(".close").removeClass("d-none")
    })
    $(".close").click(function(){
        $(this).addClass("d-none") 
        $(".search").show()
        $(".p-desc").removeClass("d-none")
        $("#my_inp").addClass("d-none")
    })

})
    </script>
    {% endblock %}
</link>